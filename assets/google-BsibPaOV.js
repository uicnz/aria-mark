class g{name="google";displayName="Google Cloud Speech-to-Text";endpoint="https://speech.googleapis.com/v1/speech:recognize";async transcribe(e,r){if(!r.apiKey)throw new Error("Google Cloud API key is required");const s=await this.audioToBase64(e.blob),t=this.getAudioEncoding(e.format),o=this.getExpectedSampleRate(e.format,t),i={audio:{content:s},config:{languageCode:r.languageCode||"en-US",alternativeLanguageCodes:r.alternativeLanguageCodes||["da-DK","en-GB","de-AT","de-DE"],encoding:t,...o&&{sampleRateHertz:o},audioChannelCount:1}},n=await fetch(`${this.endpoint}?key=${r.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!n.ok){const c=await n.text();try{const a=JSON.parse(c);throw a.error?.message?.includes("has not been used")||a.error?.message?.includes("disabled")?new Error("Google Cloud Speech-to-Text API is not enabled for your project. Please enable it at: https://console.cloud.google.com/apis/library/speech.googleapis.com"):a.error?.message?.includes("API key not valid")?new Error("Invalid Google Cloud API key. Please check your API key in the Google Cloud Console."):a.error?.message?.includes("are blocked")||a.error?.details?.some(u=>u.reason==="API_KEY_SERVICE_BLOCKED")?new Error("API key is restricted and cannot access Speech-to-Text API. Please remove API restrictions or create a new unrestricted key."):new Error(`Google Speech API error: ${a.error?.message||c}`)}catch{throw new Error(`Google Speech API error: ${n.status} - ${c}`)}}const l=await n.json();if(l.error)throw new Error(`Google Speech API error: ${l.error.message}`);const d=l.results?.[0]?.alternatives?.[0]?.transcript;if(!d)throw new Error("No transcription result from Google Speech API");return d.trim()}async validateConfig(e){if(!e.apiKey||e.apiKey.length<20)return!1;try{const r=`https://speech.googleapis.com/v1/operations?key=${e.apiKey}`,s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===401)return!1;if(s.status===403){const t=await s.json().catch(()=>null);return t?.error?.details?.some(o=>o.reason==="API_KEY_SERVICE_BLOCKED")||t?.error?.message?.includes("has not been used")||t?.error?.message?.includes("disabled")?"restricted":!1}return s.status<500}catch(r){return console.error("Google validation error:",r),!1}}getSupportedFormats(){return["audio/webm","audio/webm;codecs=opus","audio/wav","audio/flac","audio/ogg","audio/mp3","audio/mpeg"]}async audioToBase64(e){if(typeof Buffer<"u"&&e instanceof Buffer)return e.toString("base64");const r=e;return new Promise((s,t)=>{const o=new FileReader;o.onload=()=>{if(typeof o.result=="string"){const i=o.result.split(",")[1];s(i)}else t(new Error("Failed to convert audio to base64"))},o.onerror=()=>t(o.error),o.readAsDataURL(r)})}getAudioEncoding(e){return e.includes("webm")?"WEBM_OPUS":e.includes("wav")?"LINEAR16":e.includes("flac")?"FLAC":e.includes("ogg")?"OGG_OPUS":e.includes("mp3")||e.includes("mpeg")?"MP3":"WEBM_OPUS"}getExpectedSampleRate(e,r){return null}}export{g as GoogleProvider};
